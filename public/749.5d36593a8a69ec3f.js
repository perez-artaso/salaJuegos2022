"use strict";(self.webpackChunksala_juegos_2022=self.webpackChunksala_juegos_2022||[]).push([[749],{8749:(B,d,l)=>{l.r(d),l.d(d,{ElCaminoModule:()=>q});var m=l(6895),u=l(7001);class f{constructor(s,e,i,o){this.id="",this.user_id=s,this.user_email=e,this.score=i,this.timestamp=o}getLiteralObjectRepresentation(){return{user_id:this.user_id,user_email:this.user_email,score:this.score,timestamp:this.timestamp}}}var t=l(4650),_=l(8738),p=l(7579);let g=(()=>{class n{constructor(){this.newBoardNotifier$=new p.x,this.lightsNotifier$=new p.x}NewBoardRequest(){return this.newBoardNotifier$}AskForNewBoard(){this.newBoardNotifier$.next()}LightsRequest(){return this.lightsNotifier$}AskForLights(e){this.lightsNotifier$.next(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var v=l(2557),r=(()=>{return(n=r||(r={})).Up="u",n.Right="r",n.Down="d",n.Left="l",r;var n})();class C{constructor(s,e){this.from=s,this.to=e}hasDirections(s,e){return!(this.from!=s&&this.from!=e||this.to!=s&&this.to!=e)}}let w=(()=>{class n{transform(e,...i){const o="assets/";if(e){let a;return a=e.from!=r.Down&&e.from!=r.Up||e.to!=r.Down&&e.to!=r.Up?e.from!=r.Right&&e.from!=r.Left||e.to!=r.Right&&e.to!=r.Left?e.from.toString()+"2"+e.to.toString()+"-road.png":"x-road.png":"y-road.png",o+a}return o+"firewall.png"}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275pipe=t.Yjl({name:"roadblock",type:n,pure:!0}),n})();function y(n,s){if(1&n&&(t._UZ(0,"img",3),t.ALo(1,"roadblock")),2&n){const e=t.oxw();t.Q6J("ngClass",e.setClasses())("src",t.lcZ(1,2,e.roadBlock),t.LSH)}}function O(n,s){1&n&&t._UZ(0,"img",4)}function P(n,s){1&n&&t._UZ(0,"img",5)}let b=(()=>{class n{constructor(){this.roadBlock=null,this.coordinates=[],this.playerPosition=[],this.isLightOn=!0,this.isPlayerHere=!1}ngOnInit(){this.checkForPlayer()}ngOnChanges(e){e.playerPosition&&e.playerPosition.previousValue&&this.checkForPlayer()}setClasses(){return this.roadBlock?{"left-up":this.roadBlock.hasDirections(r.Left,r.Up),"left-down":this.roadBlock.hasDirections(r.Left,r.Down),"right-up":this.roadBlock.hasDirections(r.Right,r.Up),"right-down":this.roadBlock.hasDirections(r.Right,r.Down)}:{wall:!0}}checkForPlayer(){this.isPlayerHere=this.coordinates[0]===this.playerPosition[0]&&this.coordinates[1]===this.playerPosition[1]}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["square"]],inputs:{roadBlock:"roadBlock",coordinates:"coordinates",playerPosition:"playerPosition",isLightOn:["lightsOn","isLightOn"]},features:[t.TTD],decls:5,vars:3,consts:[[3,"ngClass","src",4,"ngIf","ngIfElse"],["lightsOut",""],["src","assets/car.png","id","playerChip",4,"ngIf"],[3,"ngClass","src"],["src","assets/fog.png","alt","fog"],["src","assets/car.png","id","playerChip"]],template:function(e,i){if(1&e&&(t.TgZ(0,"div"),t.YNc(1,y,2,4,"img",0),t.YNc(2,O,1,0,"ng-template",null,1,t.W1O),t.YNc(4,P,1,0,"img",2),t.qZA()),2&e){const o=t.MAs(3);t.xp6(1),t.Q6J("ngIf",i.isLightOn)("ngIfElse",o),t.xp6(3),t.Q6J("ngIf",i.isPlayerHere)}},dependencies:[m.mk,m.O5,w],styles:["div[_ngcontent-%COMP%]{overflow:hidden;position:relative}img[_ngcontent-%COMP%]{max-width:100%}.left-down[_ngcontent-%COMP%]{transform:translate(-27%,27%)}.left-up[_ngcontent-%COMP%]{transform:translate(-27%,-27%)}.right-down[_ngcontent-%COMP%]{transform:translate(27%,27%)}.right-up[_ngcontent-%COMP%]{transform:translate(27%,-27%)}#playerChip[_ngcontent-%COMP%]{position:absolute;max-width:75%;top:50%;left:50%;transform:translate(-50%,-50%);background-color:#b8860b;border-radius:100%}"]}),n})();const x=function(n,s){return[n,s]};function M(n,s){if(1&n&&t._UZ(0,"square",4),2&n){const e=s.$implicit,i=s.index,o=t.oxw().index,a=t.oxw();t.Q6J("lightsOn",a.lightsOn)("roadBlock",e)("coordinates",t.WLB(4,x,o,i))("playerPosition",a.playerPosition)}}function T(n,s){if(1&n&&(t.TgZ(0,"div",2),t.YNc(1,M,1,7,"square",3),t.qZA()),2&n){const e=s.$implicit;t.xp6(1),t.Q6J("ngForOf",e)}}let Z=(()=>{class n{constructor(e){this.boardService=e,this.board=[],this.roadPath=[],this.rows=0,this.columns=0,this.playerPosition=[0,0],this.inputtedDirection={},this.lightsOn=!0,this.wrongMoves=0,this.wrongMoveEmitter=new t.vpe,this.victoryEmitter=new t.vpe}ngOnInit(){this.setRoadPath(),this.buildBoard(),this.boardService.NewBoardRequest().subscribe(()=>{this.setRoadPath(),this.buildBoard(),this.lightsOn=!0,this.inputtedDirection={},this.wrongMoves=0}),this.boardService.LightsRequest().subscribe(e=>this.lightsOn=e)}ngOnChanges(e){e.inputtedDirection&&e.inputtedDirection.previousValue&&this.moveChip(e.inputtedDirection.currentValue)}setRoadPath(){this.roadPath=this.generatePath([[0,0]],[this.rows-1,this.columns-1])}generatePath(e,i){const o=Math.floor(2*Math.random()),a=0===o?1:0,c=e[e.length-1];let h=c.concat();return c[0]!=i[0]||c[1]!=i[1]?(c[o]<i[o]?h[o]=c[o]+1:c[a]<i[a]&&(h[a]=c[a]+1),this.generatePath(e.concat([h]),i)):e}buildBoard(){this.playerPosition=[0,0];let e=[];const i=this.roadPath.concat();let o=0;for(let a=0;a<this.rows;a++){e.push([]);for(let c=0;c<this.columns;c++)a==i[o][0]&&c==i[o][1]?(e[e.length-1].push(new C(this.determineFrom(i[o],i[o-1]),this.determineTo(i[o],i[o+1]))),o++):e[e.length-1].push(null)}this.board=e}determineFrom(e,i){if(i){const o=i[0],a=e[0];return 0==e[0]&&0==e[1]?r.Left:a!=o?r.Up:r.Left}return r.Left}determineTo(e,i){return i&&e[0]!=i[0]?r.Down:r.Right}moveChip(e){let i=!1;const a=this.getNewCoordinate(this.playerPosition,e.direction);this.roadPath.forEach(c=>{c[0]===a[0]&&c[1]===a[1]&&(this.playerPosition=a,i=!0,this.checkIfPlayerWon(a))}),i||this.tookWrongWay()}getNewCoordinate(e,i){let o=e.concat();switch(i){case"u":o[0]--;break;case"r":o[1]++;break;case"d":o[0]++;break;case"l":o[1]--}return o}tookWrongWay(){this.wrongMoves++,this.emitWrongMove()}emitWrongMove(){this.wrongMoveEmitter.emit()}checkIfPlayerWon(e){e[0]==this.rows-1&&e[1]==this.columns-1&&this.victoryEmitter.emit()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(g))},n.\u0275cmp=t.Xpm({type:n,selectors:[["board"]],inputs:{rows:"rows",columns:"columns",inputtedDirection:["direction","inputtedDirection"],lightsOn:"lightsOn"},outputs:{wrongMoveEmitter:"onWrongMove",victoryEmitter:"onVictory"},features:[t.TTD],decls:2,vars:1,consts:[["id","ec-board"],["class","ec-row",4,"ngFor","ngForOf"],[1,"ec-row"],["class","ec-square",3,"lightsOn","roadBlock","coordinates","playerPosition",4,"ngFor","ngForOf"],[1,"ec-square",3,"lightsOn","roadBlock","coordinates","playerPosition"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0),t.YNc(1,T,2,1,"div",1),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngForOf",i.board))},dependencies:[m.sg,b],styles:["#ec-board[_ngcontent-%COMP%]{display:flex;flex-direction:column;border:1px solid gray;border-radius:5px;max-width:100vh}.ec-row[_ngcontent-%COMP%]{display:flex;flex-basis:100%}.ec-square[_ngcontent-%COMP%]{max-width:100%}"]}),n})(),k=(()=>{class n{constructor(){this.inputEmitter=new t.vpe}ngOnInit(){}emitInput(e){this.inputEmitter.emit(e)}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["d-pad"]],outputs:{inputEmitter:"onInput"},decls:13,vars:0,consts:[["id","d-pad-container"],["id","first-row"],[1,"empty-space"],["id","up","src","assets/up-chevron.png","alt","up-btn",3,"click"],["id","second-row"],["id","left","src","assets/left-chevron.png","alt","left-btn",3,"click"],["id","right","src","assets/right-chevron.png","alt","right-btn",3,"click"],["id","third-row"],["id","down","src","assets/down-chevron.png","alt","down-btn",3,"click"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"div",1),t._UZ(2,"div",2),t.TgZ(3,"img",3),t.NdJ("click",function(){return i.emitInput("u")}),t.qZA(),t._UZ(4,"div",2),t.qZA(),t.TgZ(5,"div",4)(6,"img",5),t.NdJ("click",function(){return i.emitInput("l")}),t.qZA(),t._UZ(7,"div",2),t.TgZ(8,"img",6),t.NdJ("click",function(){return i.emitInput("r")}),t.qZA()(),t.TgZ(9,"div",7),t._UZ(10,"div",2),t.TgZ(11,"img",8),t.NdJ("click",function(){return i.emitInput("d")}),t.qZA(),t._UZ(12,"div",2),t.qZA()())},styles:["#d-pad-container[_ngcontent-%COMP%]{display:flex;width:20vw;flex-direction:column}#first-row[_ngcontent-%COMP%], #second-row[_ngcontent-%COMP%], #third-row[_ngcontent-%COMP%]{display:flex;flex-basis:100%}.empty-space[_ngcontent-%COMP%]{min-width:33%}img[_ngcontent-%COMP%]{max-width:33%;border-radius:5px;cursor:pointer}img[_ngcontent-%COMP%]:active{transform:scale(.9)}"]}),n})();function E(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"d-pad",7),t.NdJ("onInput",function(o){t.CHM(e);const a=t.oxw();return t.KtG(a.moveChip(o))}),t.qZA()}}function S(n,s){if(1&n&&(t.TgZ(0,"div",8),t._UZ(1,"img",9),t._uU(2),t.qZA()),2&n){const e=t.oxw();t.xp6(2),t.hij(" ",e.timer," ")}}function I(n,s){1&n&&t._UZ(0,"img",12)}function D(n,s){if(1&n&&(t.TgZ(0,"div",10),t.YNc(1,I,1,0,"img",11),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.lives)}}function N(n,s){if(1&n){const e=t.EpF();t.TgZ(0,"button",15),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(2);return t.KtG(o.newGame())}),t._uU(1," Volver A Jugar "),t.qZA()}}function F(n,s){if(1&n&&(t.TgZ(0,"div",13),t._uU(1),t._UZ(2,"br"),t._uU(3),t.qZA(),t.YNc(4,N,2,0,"button",14)),2&n){const e=t.oxw();t.Q6J("ngClass",e.setMessageClasses()),t.xp6(1),t.hij(" ",e.message," "),t.xp6(2),t.hij(" Puntuaci\xf3n Acumulada: ",e.playerScore.score," "),t.xp6(1),t.Q6J("ngIf",0==e.timer)}}const R=[{path:"",children:[{path:"",component:(()=>{class n{constructor(e,i,o){this.scores=e,this.boardService=i,this.auth=o,this.directionObject={},this.lives=[1,1,1],this.timer=5,this.lightsOn=!0,this.gameOver=!0,this.won=!1,this.playerScore={},this.message="\xa1 Record\xe1 el camino !"}ngOnInit(){this.initScore(),this.setTimer()}moveChip(e){this.directionObject={direction:e,timestamp:Date.now()}}wrongMove(){this.lives.pop(),0==this.lives.length&&(this.gameOver=!0,this.boardService.AskForLights(!0),this.message="\xa1PERDISTE!")}setMessageClasses(){return{"alert alert-danger":0==this.lives.length,"alert alert-success":0!=this.lives.length}}newGame(){this.directionObject={},this.lives=[1,1,1],this.timer=5,this.message="",this.lightsOn=!0,this.gameOver=!0,this.won=!1,this.boardService.AskForNewBoard(),this.setTimer()}setTimer(){const e=setInterval(()=>{this.timer--,0==this.timer&&this.lightsOut(e)},1e3)}lightsOut(e){clearInterval(e),this.gameOver=!1,this.lightsOn=!1}wonGame(){this.won=!0,this.gameOver=!0,this.lightsOn=!0,this.message="\xa1Felicidades! \xa1 GANASTE !",this.playerScore.score=this.playerScore.score+this.lives.length,this.updateScore()}initScore(){this.scores.getDocuments().subscribe(e=>{const i=e.filter(o=>o.user_id==this.auth.GetCurrentUserID());if(0==i.length){const o=new f(this.auth.GetCurrentUserID(),this.auth.GetCurrentUserEmail(),0,Date.now().toString());this.scores.addDocument(o.getLiteralObjectRepresentation()).then(()=>this.playerScore=o)}else this.playerScore=i[0]})}updateScore(){this.playerScore.timestamp=Date.now().toString(),this.scores.updateDocument(this.playerScore.id,this.playerScore)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(_.Y),t.Y36(g),t.Y36(v.e))},n.\u0275cmp=t.Xpm({type:n,selectors:[["el-camino"]],decls:8,vars:8,consts:[["id","board-container"],[3,"rows","columns","direction","lightsOn","onWrongMove","onVictory"],["id","d-pad-container"],[3,"onInput",4,"ngIf"],["style","font-size: 3rem;",4,"ngIf"],["id","player-lifes",4,"ngIf","ngIfElse"],["messageBlock",""],[3,"onInput"],[2,"font-size","3rem"],["src","assets/timer.png","alt","timer",2,"max-width","5vw"],["id","player-lifes"],["src","assets/lives.png","alt","heart-img",4,"ngFor","ngForOf"],["src","assets/lives.png","alt","heart-img"],[1,"userMessage",3,"ngClass"],["class","btn btn-primary",3,"click",4,"ngIf"],[1,"btn","btn-primary",3,"click"]],template:function(e,i){if(1&e&&(t.TgZ(0,"div",0)(1,"board",1),t.NdJ("onWrongMove",function(){return i.wrongMove()})("onVictory",function(){return i.wonGame()}),t.qZA(),t.TgZ(2,"div",2),t.YNc(3,E,1,0,"d-pad",3),t.YNc(4,S,3,1,"div",4),t.YNc(5,D,2,1,"div",5),t.YNc(6,F,5,4,"ng-template",null,6,t.W1O),t.qZA()()),2&e){const o=t.MAs(7);t.xp6(1),t.Q6J("rows",7)("columns",9)("direction",i.directionObject)("lightsOn",i.lightsOn),t.xp6(2),t.Q6J("ngIf",!i.gameOver),t.xp6(1),t.Q6J("ngIf",0!=i.timer),t.xp6(1),t.Q6J("ngIf",!i.gameOver)("ngIfElse",o)}},dependencies:[m.mk,m.sg,m.O5,Z,k],styles:["#board-container[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}#d-pad-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-around;flex-direction:column}#player-lifes[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-around;width:100%}#player-lifes[_ngcontent-%COMP%] > img[_ngcontent-%COMP%]{max-width:5vw}.userMessage[_ngcontent-%COMP%]{padding:3rem;border-radius:5px}"]}),n})()}]}];let A=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[u.Bz.forChild(R),u.Bz]}),n})(),q=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[m.ez,A]}),n})()}}]);